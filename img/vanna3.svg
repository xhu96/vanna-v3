<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 720" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif">
  <defs>
    <linearGradient id="headerGrad" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#7C3AED"/>
      <stop offset="100%" stop-color="#2563EB"/>
    </linearGradient>
    <linearGradient id="agentGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#F5F3FF"/>
      <stop offset="100%" stop-color="#EDE9FE"/>
    </linearGradient>
    <linearGradient id="v3Grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#ECFDF5"/>
      <stop offset="100%" stop-color="#D1FAE5"/>
    </linearGradient>
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1100" height="720" rx="12" fill="#FAFBFF"/>

  <!-- Title bar -->
  <rect x="0" y="0" width="1100" height="56" rx="12" fill="url(#headerGrad)"/>
  <rect x="0" y="30" width="1100" height="26" fill="url(#headerGrad)"/>
  <text x="550" y="37" text-anchor="middle" fill="white" font-size="22" font-weight="700">Vanna 3.0 Architecture</text>

  <!-- ===== ROW 1: User + Web Component ===== -->
  <!-- User -->
  <g filter="url(#shadow)">
    <rect x="40" y="85" width="160" height="70" rx="10" fill="#FFF" stroke="#CBD5E1" stroke-width="1.5"/>
    <text x="120" y="115" text-anchor="middle" font-size="13" fill="#64748B">ğŸ‘¤</text>
    <text x="120" y="135" text-anchor="middle" font-size="13" font-weight="600" fill="#1E293B">User</text>
  </g>

  <!-- Arrow User â†’ Web Component -->
  <line x1="200" y1="120" x2="260" y2="120" stroke="#94A3B8" stroke-width="1.5" marker-end="url(#arrowGray)"/>
  <defs><marker id="arrowGray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#94A3B8"/></marker></defs>

  <!-- Web Component -->
  <g filter="url(#shadow)">
    <rect x="260" y="85" width="220" height="70" rx="10" fill="#FFF" stroke="#7C3AED" stroke-width="1.5"/>
    <text x="370" y="112" text-anchor="middle" font-size="13" fill="#7C3AED" font-weight="600">&lt;vanna-chat&gt;</text>
    <text x="370" y="132" text-anchor="middle" font-size="11" fill="#64748B">SSE / Polling â€¢ ChartSpec Renderer</text>
  </g>

  <!-- Arrow Web Component â†’ Server -->
  <line x1="480" y1="120" x2="540" y2="120" stroke="#94A3B8" stroke-width="1.5" marker-end="url(#arrowGray)"/>

  <!-- Server -->
  <g filter="url(#shadow)">
    <rect x="540" y="78" width="520" height="85" rx="10" fill="#FFF" stroke="#2563EB" stroke-width="1.5"/>
    <text x="800" y="105" text-anchor="middle" font-size="14" font-weight="700" fill="#1E40AF">ğŸ  Your Server  (FastAPI / Flask)</text>
    <text x="800" y="126" text-anchor="middle" font-size="11" fill="#64748B">Auth Middleware â€¢ Rate Limiter â€¢ CORS â€¢ /api/vanna/v3/*</text>
    <text x="800" y="144" text-anchor="middle" font-size="11" fill="#64748B">User Resolver  â†’  Identity flows through every layer</text>
  </g>

  <!-- ===== ROW 2: Agent core ===== -->
  <g filter="url(#shadow)">
    <rect x="40" y="195" width="1020" height="120" rx="12" fill="url(#agentGrad)" stroke="#7C3AED" stroke-width="1.5"/>
    <text x="550" y="220" text-anchor="middle" font-size="15" font-weight="700" fill="#5B21B6">ğŸ¤–  Agent  (User-Aware, Streaming)</text>

    <!-- Sub-boxes inside Agent -->
    <!-- Tool Registry -->
    <rect x="60" y="238" width="190" height="60" rx="8" fill="#FFF" stroke="#A78BFA" stroke-width="1"/>
    <text x="155" y="262" text-anchor="middle" font-size="12" font-weight="600" fill="#5B21B6">ğŸ§° Tool Registry</text>
    <text x="155" y="280" text-anchor="middle" font-size="10" fill="#64748B">RunSQL â€¢ Custom Tools</text>

    <!-- Streaming Engine -->
    <rect x="270" y="238" width="190" height="60" rx="8" fill="#FFF" stroke="#A78BFA" stroke-width="1"/>
    <text x="365" y="262" text-anchor="middle" font-size="12" font-weight="600" fill="#5B21B6">âš¡ Streaming Events</text>
    <text x="365" y="280" text-anchor="middle" font-size="10" fill="#64748B">Typed v3 SSE contract</text>

    <!-- Lifecycle Hooks -->
    <rect x="480" y="238" width="190" height="60" rx="8" fill="#FFF" stroke="#A78BFA" stroke-width="1"/>
    <text x="575" y="262" text-anchor="middle" font-size="12" font-weight="600" fill="#5B21B6">ğŸ”— Lifecycle Hooks</text>
    <text x="575" y="280" text-anchor="middle" font-size="10" fill="#64748B">Quota â€¢ Logging â€¢ Filters</text>

    <!-- Read-Only SQL -->
    <rect x="690" y="238" width="170" height="60" rx="8" fill="#FFF" stroke="#A78BFA" stroke-width="1"/>
    <text x="775" y="262" text-anchor="middle" font-size="12" font-weight="600" fill="#5B21B6">ğŸ”’ Read-Only SQL</text>
    <text x="775" y="280" text-anchor="middle" font-size="10" fill="#64748B">Secure-by-default</text>

    <!-- LLM Middlewares -->
    <rect x="880" y="238" width="160" height="60" rx="8" fill="#FFF" stroke="#A78BFA" stroke-width="1"/>
    <text x="960" y="262" text-anchor="middle" font-size="12" font-weight="600" fill="#5B21B6">ğŸ§  LLM Middleware</text>
    <text x="960" y="280" text-anchor="middle" font-size="10" fill="#64748B">Cache â€¢ Prompt Eng.</text>
  </g>

  <!-- ===== ROW 3: v3 Services ===== -->
  <g filter="url(#shadow)">
    <rect x="40" y="345" width="1020" height="120" rx="12" fill="url(#v3Grad)" stroke="#059669" stroke-width="1.5"/>
    <text x="550" y="372" text-anchor="middle" font-size="15" font-weight="700" fill="#065F46">âœ¨  v3.0 Services  (New)</text>

    <!-- ChartSpec -->
    <rect x="55" y="388" width="180" height="60" rx="8" fill="#FFF" stroke="#34D399" stroke-width="1"/>
    <text x="145" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#065F46">ğŸ“Š ChartSpec</text>
    <text x="145" y="430" text-anchor="middle" font-size="10" fill="#64748B">Vega-Lite / Plotly JSON</text>

    <!-- Schema Sync -->
    <rect x="250" y="388" width="180" height="60" rx="8" fill="#FFF" stroke="#34D399" stroke-width="1"/>
    <text x="340" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#065F46">ğŸ”„ Schema Sync</text>
    <text x="340" y="430" text-anchor="middle" font-size="10" fill="#64748B">Drift detect + patch</text>

    <!-- Lineage -->
    <rect x="445" y="388" width="180" height="60" rx="8" fill="#FFF" stroke="#34D399" stroke-width="1"/>
    <text x="535" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#065F46">ğŸ“‹ Lineage</text>
    <text x="535" y="430" text-anchor="middle" font-size="10" fill="#64748B">Evidence + Confidence</text>

    <!-- Feedback -->
    <rect x="640" y="388" width="180" height="60" rx="8" fill="#FFF" stroke="#34D399" stroke-width="1"/>
    <text x="730" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#065F46">ğŸ‘ Feedback</text>
    <text x="730" y="430" text-anchor="middle" font-size="10" fill="#64748B">Corrective memory patches</text>

    <!-- Semantic Router -->
    <rect x="835" y="388" width="210" height="60" rx="8" fill="#FFF" stroke="#34D399" stroke-width="1"/>
    <text x="940" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#065F46">ğŸ§  Semantic Router</text>
    <text x="940" y="430" text-anchor="middle" font-size="10" fill="#64748B">Metrics â†’ SQL fallback</text>
  </g>

  <!-- ===== ROW 4: Integrations ===== -->
  <!-- LLM -->
  <g filter="url(#shadow)">
    <rect x="40" y="500" width="310" height="85" rx="10" fill="#FFF" stroke="#F59E0B" stroke-width="1.5"/>
    <text x="195" y="530" text-anchor="middle" font-size="14" font-weight="700" fill="#92400E">ğŸ”®  LLM Provider</text>
    <text x="195" y="550" text-anchor="middle" font-size="11" fill="#64748B">OpenAI â€¢ Anthropic â€¢ Gemini â€¢ Ollama</text>
    <text x="195" y="567" text-anchor="middle" font-size="11" fill="#64748B">Azure â€¢ Bedrock â€¢ Mistral â€¢ Others</text>
  </g>

  <!-- Database -->
  <g filter="url(#shadow)">
    <rect x="395" y="500" width="310" height="85" rx="10" fill="#FFF" stroke="#3B82F6" stroke-width="1.5"/>
    <text x="550" y="530" text-anchor="middle" font-size="14" font-weight="700" fill="#1E40AF">ğŸ—„ï¸  Database</text>
    <text x="550" y="550" text-anchor="middle" font-size="11" fill="#64748B">PostgreSQL â€¢ MySQL â€¢ Snowflake â€¢ BigQuery</text>
    <text x="550" y="567" text-anchor="middle" font-size="11" fill="#64748B">Redshift â€¢ SQLite â€¢ DuckDB â€¢ Others</text>
  </g>

  <!-- Memory / Vector Store -->
  <g filter="url(#shadow)">
    <rect x="750" y="500" width="310" height="85" rx="10" fill="#FFF" stroke="#8B5CF6" stroke-width="1.5"/>
    <text x="905" y="530" text-anchor="middle" font-size="14" font-weight="700" fill="#5B21B6">ğŸ§   Agent Memory</text>
    <text x="905" y="550" text-anchor="middle" font-size="11" fill="#64748B">RAG â€¢ Context Enrichers</text>
    <text x="905" y="567" text-anchor="middle" font-size="11" fill="#64748B">Conversation History â€¢ Corrections</text>
  </g>

  <!-- ===== ROW 5: Outputs ===== -->
  <g filter="url(#shadow)">
    <rect x="40" y="620" width="1020" height="75" rx="10" fill="#FFF" stroke="#CBD5E1" stroke-width="1.5"/>
    <text x="550" y="648" text-anchor="middle" font-size="14" font-weight="700" fill="#1E293B">ğŸ“¤  Streamed Response</text>
    <text x="550" y="672" text-anchor="middle" font-size="12" fill="#64748B">
      Progress  â†’  SQL  â†’  Data Table  â†’  ChartSpec  â†’  Summary  â†’  Lineage Evidence
    </text>
  </g>

  <!-- Connecting arrows (vertical) -->
  <!-- Server â†’ Agent -->
  <line x1="550" y1="163" x2="550" y2="195" stroke="#7C3AED" stroke-width="1.5" marker-end="url(#arrowPurple)"/>
  <defs><marker id="arrowPurple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#7C3AED"/></marker></defs>

  <!-- Agent â†’ v3 Services -->
  <line x1="550" y1="315" x2="550" y2="345" stroke="#059669" stroke-width="1.5" marker-end="url(#arrowGreen)"/>
  <defs><marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#059669"/></marker></defs>

  <!-- v3 Services â†’ Integrations (3 arrows) -->
  <line x1="195" y1="465" x2="195" y2="500" stroke="#F59E0B" stroke-width="1.5" marker-end="url(#arrowAmber)"/>
  <defs><marker id="arrowAmber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#F59E0B"/></marker></defs>

  <line x1="550" y1="465" x2="550" y2="500" stroke="#3B82F6" stroke-width="1.5" marker-end="url(#arrowBlue)"/>
  <defs><marker id="arrowBlue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#3B82F6"/></marker></defs>

  <line x1="905" y1="465" x2="905" y2="500" stroke="#8B5CF6" stroke-width="1.5" marker-end="url(#arrowViolet)"/>
  <defs><marker id="arrowViolet" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#8B5CF6"/></marker></defs>

  <!-- Integrations â†’ Outputs -->
  <line x1="550" y1="585" x2="550" y2="620" stroke="#94A3B8" stroke-width="1.5" marker-end="url(#arrowGray)"/>

  <!-- Version badge -->
  <rect x="970" y="10" width="110" height="28" rx="14" fill="rgba(255,255,255,0.2)"/>
  <text x="1025" y="30" text-anchor="middle" font-size="12" font-weight="600" fill="white">v3.0 Â· Fork</text>
</svg>
