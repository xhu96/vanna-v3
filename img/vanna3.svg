<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 800" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif" style="background-color: #0b0f19;">
  <defs>
    <!-- Patterns -->
    <pattern id="gridPattern" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#ffffff" stroke-width="0.5" stroke-opacity="0.05" />
    </pattern>
    <pattern id="dotPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
      <circle cx="2" cy="2" r="1.2" fill="#ffffff" fill-opacity="0.08" />
    </pattern>

    <!-- Gradients -->
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#4F46E5" />
      <stop offset="100%" stop-color="#06B6D4" />
    </linearGradient>

    <linearGradient id="agentGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#3B82F6" />
    </linearGradient>

    <linearGradient id="v3Grad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#10B981" />
      <stop offset="100%" stop-color="#059669" />
    </linearGradient>

    <linearGradient id="cardGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#1e293b" stop-opacity="0.9" />
      <stop offset="100%" stop-color="#0f172a" stop-opacity="0.9" />
    </linearGradient>
    
    <linearGradient id="solidCard" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#1e293b" />
      <stop offset="100%" stop-color="#0f172a" />
    </linearGradient>

    <!-- Filters -->
    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="10" result="blur" />
      <feComposite in="SourceGraphic" in2="blur" operator="over" />
    </filter>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="110%">
      <feDropShadow dx="0" dy="8" stdDeviation="10" flood-color="#000" flood-opacity="0.5"/>
    </filter>

    <!-- Arrow Markers -->
    <marker id="arrowGray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#94A3B8"/></marker>
    <marker id="arrowPurple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#8B5CF6"/></marker>
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#10B981"/></marker>
    <marker id="arrowAmber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#F59E0B"/></marker>
    <marker id="arrowBlue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#3B82F6"/></marker>
    <marker id="arrowViolet" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#8B5CF6"/></marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="800" rx="12" fill="#0b0f19"/>
  <rect width="1100" height="800" fill="url(#gridPattern)" />
  <rect width="1100" height="800" fill="url(#dotPattern)" />

  <!-- Title bar -->
  <rect x="0" y="0" width="1100" height="56" rx="12" fill="url(#headerGrad)"/>
  <rect x="0" y="30" width="1100" height="26" fill="url(#headerGrad)"/>
  <text x="550" y="37" text-anchor="middle" fill="white" font-size="24" font-weight="800" letter-spacing="0.5">Vanna 3.1 Architecture</text>
  
  <rect x="970" y="14" width="110" height="28" rx="14" fill="#0b0f19" opacity="0.4"/>
  <text x="1025" y="33" text-anchor="middle" font-size="14" font-weight="700" fill="#38ef7d">v3.1.0</text>

  <!-- ===== ROW 1: User + Web Component ===== -->
  <!-- User -->
  <g transform="translate(40, 95)" filter="url(#shadow)">
    <rect width="160" height="70" rx="14" fill="url(#cardGrad)" stroke="#334155" stroke-width="1.5"/>
    <text x="80" y="30" text-anchor="middle" font-size="20" fill="#94A3B8">ğŸ‘¤</text>
    <text x="80" y="52" text-anchor="middle" font-size="14" font-weight="700" fill="#f8fafc">User</text>
  </g>

  <!-- Arrow User â†’ Web Component -->
  <line x1="200" y1="130" x2="260" y2="130" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Web Component -->
  <g transform="translate(260, 95)" filter="url(#shadow)">
    <rect width="230" height="70" rx="14" fill="url(#cardGrad)" stroke="#06B6D4" stroke-width="2"/>
    <text x="115" y="32" text-anchor="middle" font-size="16" fill="#00C6FF" font-weight="700">&lt;vanna-chat&gt;</text>
    <text x="115" y="52" text-anchor="middle" font-size="12" fill="#94A3B8">SSE/Polling â€¢ ChartSpec</text>
  </g>

  <!-- Arrow Web Component â†’ Server -->
  <line x1="490" y1="130" x2="540" y2="130" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Server -->
  <g transform="translate(540, 85)" filter="url(#shadow)">
    <rect width="520" height="90" rx="14" fill="url(#cardGrad)" stroke="#3B82F6" stroke-width="2"/>
    <text x="260" y="32" text-anchor="middle" font-size="16" font-weight="800" fill="#60A5FA">ğŸ Your Server (FastAPI/Flask)</text>
    <text x="260" y="54" text-anchor="middle" font-size="12" fill="#94A3B8">Auth Middleware â€¢ Rate Limiter â€¢ CORS â€¢ /api/vanna/v3/*</text>
    <text x="260" y="74" text-anchor="middle" font-size="12" fill="#cbd5e1" font-weight="600">User Resolver â†’ Identity flows through every layer</text>
  </g>

  <!-- ===== ROW 2: Agent core ===== -->
  <g transform="translate(40, 215)" filter="url(#shadow)">
    <rect width="1020" height="130" rx="20" fill="#0f172a" stroke="url(#agentGrad)" stroke-width="2"/>
    <rect width="1020" height="130" rx="20" fill="url(#agentGrad)" opacity="0.05"/>
    <text x="510" y="32" text-anchor="middle" font-size="18" font-weight="800" fill="#A78BFA">ğŸ¤– Agent (User-Aware, Streaming)</text>

    <!-- Sub-boxes inside Agent -->
    <rect x="25" y="50" width="180" height="60" rx="12" fill="url(#solidCard)" stroke="#4C1D95" stroke-width="1.5"/>
    <text x="115" y="74" text-anchor="middle" font-size="14" font-weight="700" fill="#C4B5FD">ğŸ§° Tool Registry</text>
    <text x="115" y="94" text-anchor="middle" font-size="11" fill="#94A3B8">RunSQL â€¢ Custom Tools</text>

    <rect x="225" y="50" width="180" height="60" rx="12" fill="url(#solidCard)" stroke="#4C1D95" stroke-width="1.5"/>
    <text x="315" y="74" text-anchor="middle" font-size="14" font-weight="700" fill="#C4B5FD">âš¡ Streaming Events</text>
    <text x="315" y="94" text-anchor="middle" font-size="11" fill="#94A3B8">Typed v3 SSE contract</text>

    <rect x="425" y="50" width="180" height="60" rx="12" fill="url(#solidCard)" stroke="#4C1D95" stroke-width="1.5"/>
    <text x="515" y="74" text-anchor="middle" font-size="14" font-weight="700" fill="#C4B5FD">ğŸ”— Lifecycle Hooks</text>
    <text x="515" y="94" text-anchor="middle" font-size="11" fill="#94A3B8">Quota â€¢ Logging â€¢ Filters</text>

    <rect x="625" y="50" width="170" height="60" rx="12" fill="url(#solidCard)" stroke="#4C1D95" stroke-width="1.5"/>
    <text x="710" y="74" text-anchor="middle" font-size="14" font-weight="700" fill="#C4B5FD">ğŸ”’ Read-Only SQL</text>
    <text x="710" y="94" text-anchor="middle" font-size="11" fill="#94A3B8">Secure-by-default</text>

    <rect x="815" y="50" width="180" height="60" rx="12" fill="url(#solidCard)" stroke="#4C1D95" stroke-width="1.5"/>
    <text x="905" y="74" text-anchor="middle" font-size="14" font-weight="700" fill="#C4B5FD">ğŸ§  LLM Middleware</text>
    <text x="905" y="94" text-anchor="middle" font-size="11" fill="#94A3B8">Cache â€¢ Prompt Eng.</text>
  </g>

  <!-- ===== ROW 3: v3 Services (Updated) ===== -->
  <g transform="translate(40, 385)" filter="url(#shadow)">
    <rect width="1020" height="130" rx="20" fill="#0f172a" stroke="url(#v3Grad)" stroke-width="2"/>
    <rect width="1020" height="130" rx="20" fill="url(#v3Grad)" opacity="0.05"/>
    <text x="510" y="32" text-anchor="middle" font-size="18" font-weight="800" fill="#34D399">âœ¨ v3.1 Services (Expanded)</text>

    <rect x="20" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="85" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ‘¤ Profiles</text>
    <text x="85" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Glossary â€¢ PII</text>

    <rect x="160" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="225" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ§© Skill Fabric</text>
    <text x="225" y="94" text-anchor="middle" font-size="10" fill="#38ef7d" font-weight="600">Registry â€¢ Ad-Hoc</text>

    <rect x="300" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="365" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ§  Router</text>
    <text x="365" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Metric â†’ SQL</text>

    <rect x="440" y="50" width="140" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="510" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ”„ Drift Sync</text>
    <text x="510" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Detect &amp; Patch</text>

    <rect x="590" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="655" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ“Š ChartSpec</text>
    <text x="655" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Declarative UI</text>

    <rect x="730" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="795" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ“‹ Lineage</text>
    <text x="795" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Evidence Trail</text>

    <rect x="870" y="50" width="130" height="60" rx="12" fill="url(#solidCard)" stroke="#065F46" stroke-width="1.5"/>
    <text x="935" y="74" text-anchor="middle" font-size="13" font-weight="700" fill="#6EE7B7">ğŸ‘ Feedback</text>
    <text x="935" y="94" text-anchor="middle" font-size="10" fill="#94A3B8">Mem. Patching</text>
  </g>

  <!-- ===== ROW 4: Integrations ===== -->
  <!-- LLM -->
  <g transform="translate(40, 555)" filter="url(#shadow)">
    <rect width="320" height="90" rx="16" fill="url(#cardGrad)" stroke="#F59E0B" stroke-width="2"/>
    <text x="160" y="32" text-anchor="middle" font-size="16" font-weight="800" fill="#FBBF24">ğŸ”® LLM Provider</text>
    <text x="160" y="56" text-anchor="middle" font-size="13" fill="#94A3B8">OpenAI â€¢ Anthropic â€¢ Gemini â€¢ Ollama</text>
    <text x="160" y="76" text-anchor="middle" font-size="13" fill="#38ef7d" font-weight="600">Azure â€¢ OpenRouter â€¢ Bedrock â€¢ Mistral</text>
  </g>

  <!-- Database -->
  <g transform="translate(390, 555)" filter="url(#shadow)">
    <rect width="320" height="90" rx="16" fill="url(#cardGrad)" stroke="#3B82F6" stroke-width="2"/>
    <text x="160" y="32" text-anchor="middle" font-size="16" font-weight="800" fill="#60A5FA">ğŸ—„ï¸ Database</text>
    <text x="160" y="56" text-anchor="middle" font-size="13" fill="#94A3B8">PostgreSQL â€¢ MySQL â€¢ Snowflake</text>
    <text x="160" y="76" text-anchor="middle" font-size="13" fill="#94A3B8">BigQuery â€¢ Redshift â€¢ SQLite â€¢ DuckDB</text>
  </g>

  <!-- Memory / Vector Store -->
  <g transform="translate(740, 555)" filter="url(#shadow)">
    <rect width="320" height="90" rx="16" fill="url(#cardGrad)" stroke="#8B5CF6" stroke-width="2"/>
    <text x="160" y="32" text-anchor="middle" font-size="16" font-weight="800" fill="#C4B5FD">ğŸ§  Agent Memory</text>
    <text x="160" y="56" text-anchor="middle" font-size="13" fill="#94A3B8">RAG â€¢ Context Enrichers</text>
    <text x="160" y="76" text-anchor="middle" font-size="13" fill="#94A3B8">Conversation History â€¢ Corrections</text>
  </g>

  <!-- ===== ROW 5: Outputs ===== -->
  <g transform="translate(40, 685)" filter="url(#shadow)">
    <rect width="1020" height="85" rx="16" fill="url(#cardGrad)" stroke="#64748B" stroke-width="2"/>
    <text x="510" y="36" text-anchor="middle" font-size="18" font-weight="800" fill="#f8fafc">ğŸ“¤ Streamed Response</text>
    <text x="510" y="64" text-anchor="middle" font-size="14" fill="#94A3B8" font-family="'SFMono-Regular', Consolas, monospace">
      Progress â†’ SQL â†’ Data Table â†’ ChartSpec â†’ Summary â†’ Lineage Evidence
    </text>
  </g>

  <!-- Connecting arrows (vertical) -->
  <line x1="550" y1="175" x2="550" y2="215" stroke="#8B5CF6" stroke-width="3" marker-end="url(#arrowPurple)"/>
  <line x1="550" y1="345" x2="550" y2="385" stroke="#10B981" stroke-width="3" marker-end="url(#arrowGreen)"/>

  <!-- v3 Services â†’ Integrations (3 arrows) -->
  <line x1="200" y1="515" x2="200" y2="555" stroke="#F59E0B" stroke-width="3" marker-end="url(#arrowAmber)"/>
  <line x1="550" y1="515" x2="550" y2="555" stroke="#3B82F6" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <line x1="900" y1="515" x2="900" y2="555" stroke="#8B5CF6" stroke-width="3" marker-end="url(#arrowViolet)"/>

  <!-- Integrations â†’ Outputs -->
  <line x1="550" y1="645" x2="550" y2="685" stroke="#94A3B8" stroke-width="3" marker-end="url(#arrowGray)"/>

</svg>
